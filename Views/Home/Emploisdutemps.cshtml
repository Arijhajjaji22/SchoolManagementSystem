@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = null;
}
<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<!-- beautify ignore:start -->
<html lang="en"
      class="light-style layout-menu-fixed"
      dir="ltr"
      data-theme="theme-default"
      data-assets-path="../assets/"
      data-template="vertical-menu-template-free">
<head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>ÉduNova</title>
    <meta name="description" content="" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <!-- Favicon -->
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../diplome1.png" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- Page CSS -->
    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
    <style>
        .dimanche {
            background-color: #ffcccc; /* rouge clair, tu peux mettre red ou #ff0000 si tu veux plus vif */
        }

        .emploi-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 14px;
            margin-top: 20px;
        }

            .emploi-table th, .emploi-table td {
                border: 1px solid #ccc;
                padding: 8px;
                text-align: center;
                min-width: 80px;
                vertical-align: top;
            }

        /* Couleur rouge pour les pauses */
        .pause {
            background-color: #ffcccc !important; /* Rouge clair */
            color: #900;
            font-weight: bold;
        }

        /* Style uniforme pour les en-têtes (jours et horaires) */
        .emploi-table th {
            background-color: #3498db !important; /* Bleu uniforme */
            color: white !important;
            font-weight: bold;
            text-align: center;
        }


        .seance {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid #0c5460;
            font-weight: bold;
        }
        .d-none {
            display: none !important;
        }

        .emploi-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }

        .day {
            flex: 1;
            padding: 10px;
            background-color: #f7f7f7;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .ferie {
            background-color: #ffeaea;
            color: #b30000;
            text-align: center;
        }

        .emploi-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px auto;
            max-width: 1000px;
            font-family: 'Segoe UI', sans-serif;
        }

        .day {
            border-radius: 12px;
            padding: 20px;
            background: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.07);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

            .day:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }

        /* Couleurs personnalisées pour chaque jour */
      

        .table-container {
            max-width: 1000px;
            margin: 40px auto;
            font-family: 'Segoe UI', sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
        }

        thead {
            background-color: #3498db;
            color: white;
        }

        tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tbody tr:hover {
            background-color: #d6eaf8;
        }

        .search-container {
            margin-top: 20px;
            text-align: right;
        }

            .search-container input {
                padding: 8px 12px;
                width: 250px;
                border: 1px solid #ccc;
                border-radius: 6px;
            }
        .matiere-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

          
    </style>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->

            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="/Home/DirecteurDashboard" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <img src="../diplome1.png" style="height: 60px; width: auto;  box-shadow: 0 4px 8px rgba(0,0,0,0.2);" alt="Logo" />
                        </span>


                    </a>


                    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm align-middle"></i>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>


                <ul class="menu-inner py-1">
                    <!-- Dashboard -->
                    <li class="menu-item">
                        <a href="/Home/DirecteurDashboard" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-home-circle"></i>
                            <div data-i18n="Analytics">Dashboard</div>
                        </a>
                    </li>

                    <!-- Layouts -->



                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle" style="display: flex; align-items: center;">
                            <i class="menu-icon tf-icons bx bx-user" style="font-size: 20px; color: #007bff; margin-right: 10px;"></i> <!-- Icône de gestion des utilisateurs -->
                            <div data-i18n="Gestion des utilisateurs">Gestion des utilisateurs</div>
                        </a>
                        <ul class="menu-sub">

                            <li class="menu-item ">
                                <a href="/Home/ListedesutilisateursDirecteur" class="menu-link" style="display: flex; align-items: center;">
                                    <i class="fas fa-users" style="font-size: 18px; color: #17a2b8; margin-right: 10px;"></i> <!-- Icône pour afficher la liste des comptes -->
                                    <div data-i18n="Liste des comptes">Liste des comptes</div>
                                </a>
                            </li>

                        </ul>
                    </li>
                    <li class="menu-item  ">
                        <a href="/Home/Gestiondesmatieres" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-book"></i>
                            <div data-i18n="Analytics">Gestion des matières</div>
                        </a>
                    </li>

                    <li class="menu-item">
                        <a href="/Home/GestiondesSalles" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-building-house"></i>
                            <div data-i18n="Analytics">Gestion des salles</div>
                        </a>
                    </li>
                    <li class="menu-item active open">
                        <a href="/Home/EmploisDuTemps" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-calendar"></i>
                            <div data-i18n="Analytics">Emplois du temps</div>
                        </a>
                    </li>

                </ul>
            </aside>
            <!-- / Menu -->
            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->

                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                     id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                            <i class="bx bx-menu bx-sm"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <!-- Search -->
                        <div style="width: 100%; display: flex; justify-content: flex-end; padding: 10px;">
                            <!-- Formulaire de déconnexion avec un bouton stylisé -->
                            <form method="post" asp-action="Logout" asp-controller="Admin">
                                <button type="submit" style="
            background-color: #f0f0f0; /* Couleur de fond douce */
            color: #007bff; /* Texte bleu */
            border: 1px solid #007bff; /* Bordure bleue */
            padding: 8px 15px; /* Espacement intérieur plus modéré */
            font-size: 14px; /* Taille du texte plus petite */
            border-radius: 20px; /* Coins arrondis plus prononcés */
            cursor: pointer; /* Curseur pointeur */
            transition: background-color 0.3s ease, color 0.3s ease; /* Effet de transition */
            font-weight: bold; /* Texte en gras */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Ombre douce autour du bouton */
            outline: none; /* Pas de contour */
            "
                                        onmouseover="this.style.backgroundColor='#007bff'; this.style.color='white';"
                                        onmouseout="this.style.backgroundColor='#f0f0f0'; this.style.color='#007bff';">
                                    Se déconnecter
                                </button>
                            </form>
                        </div>




                    </div>
                </nav>

                <!-- / Navbar -->
                <div class="content-wrapper">
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <h4 class="fw-bold py-3 mb-4">
                            <span class="text-muted fw-light">Gestion des emplois /</span> Emploi du professeur
                        </h4>

                        <!-- Section création emploi du temps -->
                        <!-- Formulaire de génération d'emploi -->
                        <div class="card shadow p-4 mb-4">
                            <h4 class="text-primary mb-4">Générer un emploi du temps</h4>

                            <form id="emploiForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Matière</label>
                                        <select id="matiereSelect" class="form-select" onchange="chargerProfs()">
                                            <option selected disabled>-- Sélectionner une matière --</option>
                                            <!-- Matières dynamiques -->
                                        </select>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label">Professeur</label>
                                        <select id="profSelect" class="form-select" disabled>
                                            <option selected disabled>-- Sélectionner un professeur --</option>
                                            <!-- Professeurs dynamiques -->
                                        </select>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <label class="form-label">Classe</label>
                                        <select id="classeSelect" class="form-select">
                                            <option selected disabled>-- Sélectionner une classe --</option>
                                            <option value="7ème année">7ème année</option>
                                            <option value="8ème année">8ème année</option>
                                            <option value="9ème année">9ème année</option>
                                            <option value="1ère année">1ère année</option>
                                            <option value="2ème année">2ème année</option>
                                            <option value="3ème année">3ème année</option>
                                            <option value="Terminale">Terminale</option>
                                        </select>
                                    </div>

                                </div>

                                <div class="mt-4 text-end">
                                    <button type="button" class="btn btn-success" onclick="genererEmploi()">📅 Générer Emploi</button>

                                </div>

                  
                            </form>
                        </div>

                        <!-- Liste des emplois générés -->
                        <div class="card shadow p-4">
                            <h4 class="text-primary mb-4">📋 Liste des emplois générés</h4>

                            <table class="table table-bordered" id="emploiTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>Nom</th>
                                        <th>Prénom</th>
                                        <th>Numéro Salle</th>
                                        <th>Date d'ajout</th>
                                        <th>Classe</th> <!-- Nouvelle colonne ajoutée -->
                                        <th>PDF</th>
                                    </tr>
                                </thead>


                                <tbody id="emploiBody">
                                    <!-- Contenu dynamique -->
                                </tbody>
                            </table>

                        </div>

                        <!-- Nom du professeur sélectionné -->
                        <div id="profNom" style="text-align: right; font-weight: bold; margin-top: 20px;"></div>

                        <!-- Calendrier (caché, utilisé seulement pour le PDF) -->
                        <div id="emploiCalendrier" class="d-none">
                            <div id="profNom" style="margin-bottom: 10px;"></div>
                            <table class="emploi-table">
                                <thead>
                                    <tr>
                                        <th>Jour</th>
                                        <th>8h-9h</th>
                                        <th>9h-10h</th>
                                        <th>10h-11h</th>
                                        <th>11h-12h</th>
                                        <th class="pause">12h-13h</th>
                                        <th class="pause">13h-14h</th>
                                        <th>14h-15h</th>
                                        <th>15h-16h</th>
                                        <th>16h-17h</th>
                                        <th>17h-18h</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><th>Lundi</th>     <td id="lundi-8"></td> <td id="lundi-9"></td> <td id="lundi-10"></td> <td id="lundi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="lundi-14"></td> <td id="lundi-15"></td> <td id="lundi-16"></td> <td id="lundi-17"></td></tr>
                                    <tr><th>Mardi</th>     <td id="mardi-8"></td> <td id="mardi-9"></td> <td id="mardi-10"></td> <td id="mardi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="mardi-14"></td> <td id="mardi-15"></td> <td id="mardi-16"></td> <td id="mardi-17"></td></tr>
                                    <tr><th>Mercredi</th>  <td id="mercredi-8"></td> <td id="mercredi-9"></td> <td id="mercredi-10"></td> <td id="mercredi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="mercredi-14"></td> <td id="mercredi-15"></td> <td id="mercredi-16"></td> <td id="mercredi-17"></td></tr>
                                    <tr><th>Jeudi</th>     <td id="jeudi-8"></td> <td id="jeudi-9"></td> <td id="jeudi-10"></td> <td id="jeudi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="jeudi-14"></td> <td id="jeudi-15"></td> <td id="jeudi-16"></td> <td id="jeudi-17"></td></tr>
                                    <tr><th>Vendredi</th>  <td id="vendredi-8"></td> <td id="vendredi-9"></td> <td id="vendredi-10"></td> <td id="vendredi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="vendredi-14"></td> <td id="vendredi-15"></td> <td id="vendredi-16"></td> <td id="vendredi-17"></td></tr>
                                    <tr><th>Samedi</th>    <td id="samedi-8"></td> <td id="samedi-9"></td> <td id="samedi-10"></td> <td id="samedi-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="samedi-14"></td> <td id="samedi-15"></td> <td id="samedi-16"></td> <td id="samedi-17"></td></tr>
                                    <tr class="dimanche"><th>Dimanche</th> <td id="dimanche-8"></td> <td id="dimanche-9"></td> <td id="dimanche-10"></td> <td id="dimanche-11"></td> <td class="pause"></td> <td class="pause"></td> <td id="dimanche-14"></td> <td id="dimanche-15"></td> <td id="dimanche-16"></td> <td id="dimanche-17"></td></tr>
                                </tbody>
                            </table>
                        </div>

                <!-- Footer -->
                <footer class="content-footer footer bg-footer-theme">
                    <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                        <div class="mb-2 mb-md-0">
                            ©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>

                            <a href="https://themeselection.com" target="_blank" class="footer-link fw-bolder"></a>
                        </div>
                        <div>
                        </div>
                    </div>
                </footer>
                <!-- / Footer -->

                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    
    <!-- Modal de modification -->
    <!-- Modal Modifier Professeur -->
    <!-- Modal de modification -->


    <!-- / Layout wrapper -->

    <div class="buy-now">
        <a href="https://themeselection.com/products/sneat-bootstrap-html-admin-template/"
           target="_blank"/>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        window.onload = function () {
            chargerMatieres();
                  chargerTablePdfs();
        };

                      function chargerTablePdfs() {
                    fetch('/api/emploi/pdfs')
                        .then(res => res.json())
                        .then(pdfs => {
                            const tbody = document.getElementById("emploiBody");
                            tbody.innerHTML = ""; // Vider l'ancien contenu

                            pdfs.forEach(pdf => {
                                const tr = document.createElement("tr");

                                tr.innerHTML = `
                                    <td>${pdf.professeurNom}</td>
                                    <td>${pdf.professeurPrenom}</td>
                                    <td>${pdf.numSalle}</td>
                                    <td>${new Date(pdf.dateAjout).toLocaleDateString()}</td>
                                            <td>${pdf.classe || "Non spécifiée"}</td> <!-- Nouvelle cellule pour la classe -->
                                    <td>
                                        <a class="btn btn-sm btn-success" href="data:application/pdf;base64,${pdf.pdfBase64}" download="emploi_${pdf.id}.pdf">
                                            📄 Télécharger
                                        </a>
                                    </td>
                                `;

                                tbody.appendChild(tr);
                            });
                        })
                        .catch(err => {
                            console.error("Erreur lors du chargement des PDFs :", err);
                        });
                }

        function chargerMatieres() {
            fetch('/api/emploi/matieres')
                .then(response => response.json())
                .then(matieres => {
                    const select = document.getElementById("matiereSelect");
                    matieres.forEach(matiere => {
                        const option = document.createElement("option");
                        option.value = matiere.nom; // on utilise le nom comme valeur
                        option.textContent = matiere.nom;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error("Erreur lors du chargement des matières :", error);
                });
        }
                                          async function generatePDF(emploiId, professeurId, dateDebutSemaine) {
                    const element = document.getElementById("emploiCalendrier");
                    const anneeScolaire = "2024-2025"; // Tu peux le rendre dynamique
                    const profNomComplet = document.getElementById("profNom").innerText || "Professeur inconnu";

                    element.classList.remove("d-none");
                    await new Promise(resolve => setTimeout(resolve, 300));

                    const canvas = await html2canvas(element);
                    const imgData = canvas.toDataURL("image/png");

                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();

                    pdf.setFontSize(12);
                    pdf.text(`Année scolaire : ${anneeScolaire}`, 10, 25);        // À gauche
                    pdf.text(`${profNomComplet}`, 160, 25);                        // À droite (ajusté un peu plus vers la droite)
                    pdf.text("Emploi du Temps", 105, 15, null, null, "center");   // Centre haut
                    pdf.addImage(imgData, 'PNG', 10, 40, 190, 0);

                    pdf.save("emploi_du_temps.pdf");
                    element.classList.add("d-none");
                }


        function chargerProfs() {
            const matiere = document.getElementById("matiereSelect").value;

            fetch(`/api/emploi/professeurs?matiere=${encodeURIComponent(matiere)}`)
                .then(res => res.json())
                .then(data => {
                    const select = document.getElementById("profSelect");
                    select.innerHTML = `<option selected disabled>-- Sélectionner un professeur --</option>`;
                    data.forEach(prof => {
                        select.innerHTML += `<option value="${prof.id}">${prof.nom} ${prof.prenom}</option>`;
                    });
                    select.disabled = false;
                });
        }

                            async function genererEmploi() {
                    const matiereNom = document.getElementById("matiereSelect").value;
                    const professeurId = document.getElementById("profSelect").value;
                            const classe = document.getElementById("classeSelect").value;

                    if (!matiereNom || matiereNom === "null") {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Attention',
                            text: 'Veuillez sélectionner une matière valide.'
                        });
                        return;
                    }


                    try {
                        const response = await fetch("/api/emploi/generer", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                professeurId: parseInt(professeurId),
                                matiereNom: matiereNom,
                                              classes: [classe]
                            })
                        });

                        if (!response.ok) {
                            const errorMsg = await response.text();
                            Swal.fire({
                                icon: 'error',
                                title: 'Erreur',
                                text: errorMsg || 'Une erreur est survenue lors de la génération.'
                            });
                            return;
                        }

                        const data = await response.json();
                        console.log("Données reçues :", data);

                        // Nettoyer les colonnes du calendrier
                                      // Nettoyer toutes les cellules du calendrier
                ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'].forEach(jour => {
                    [8, 9, 10, 11, 14, 15, 16, 17].forEach(heure => {
                        const cellule = document.getElementById(`${jour}-${heure}`);
                        if (cellule) {
                            cellule.innerHTML = "";
                            cellule.classList.remove("seance");
                        }
                    });
                });


                        // Afficher le nom du professeur en haut à droite
                        const nomEnseignant = data[0].professeur ? `${data[0].professeur.nom} ${data[0].professeur.prenom}` : "Non spécifié";
                        document.getElementById("profNom").innerHTML = `<span style="float: right; font-weight: bold;">${nomEnseignant}</span>`;

                        // Remplir les créneaux
                        data.forEach(creneau => {
                            if (!creneau.horaire) {
                                console.warn("Horaire manquant dans ce créneau :", creneau);
                                return;
                            }

                            const horaireParts = creneau.horaire.split(" ");
                            const horaire = horaireParts.length > 1 ? horaireParts.slice(1).join(" ") : creneau.horaire;
                                           const jour = creneau.horaire.split(" ")[0].toLowerCase();
                const heureDebut = parseInt(creneau.horaire.match(/\d{1,2}(?=h)/)?.[0] || "0");

                if (heureDebut >= 8 && heureDebut <= 11 || heureDebut >= 14 && heureDebut <= 17) {
                    const cellule = document.getElementById(`${jour}-${heureDebut}`);
                    if (cellule) {
                        cellule.classList.add("seance");
                        cellule.innerHTML = `
                            ${matiereNom}<br>
                            Salle: ${creneau.salle?.numSalle || "-"}<br>
                            Classe: ${creneau.classe || "-"}
                        `;
                    }
                }
                else {
                                console.warn("Div introuvable pour le jour :", jour, "créneau :", creneau);
                            }
                        });

                        // ✅ Affichage SweetAlert de succès
                        Swal.fire({
                            icon: 'success',
                            title: 'Succès',
                            text: 'Emplois généré avec succès.'
                        });

                        // ✅ Génération et envoi du PDF
                        const element = document.getElementById("emploiCalendrier");
                        element.classList.remove("d-none");
                        await new Promise(resolve => setTimeout(resolve, 300));

                        const canvas = await html2canvas(element);
                        const imgData = canvas.toDataURL("image/png");

                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF();
                        pdf.text("Emploi du Temps", 105, 15, null, null, "center");
                        pdf.addImage(imgData, 'PNG', 10, 40, 190, 0);

                        const pdfBase64 = pdf.output("datauristring").split(',')[1];
                        element.classList.add("d-none");

                        const uploadPayload = {
                            emploiId: data[0].emploiId, // ou un autre identifiant unique
                            professeurId: professeurId,
                            dateDebutSemaine: new Date().toISOString().slice(0, 10), // par défaut aujourd'hui
                            pdfBase64: pdfBase64,
                                    classe: classe
                        };

                        const uploadResponse = await fetch("/api/emploi/upload-pdf", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(uploadPayload)
                        });

                        const result = await uploadResponse.text();
                             chargerTablePdfs();

                    } catch (error) {
                        console.error("Erreur lors de la génération de l'emploi :", error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Erreur',
                            text: 'Une erreur est survenue lors de la génération.'
                        });
                    }
                }


    </script>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script src="../assets/vendor/js/menu.js"></script>
    <!-- endbuild -->
    <!-- Vendors JS -->
    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>

    <!-- Page JS -->
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</body>
</html>

